import{u as D,r as i,c as E,j as e,L as g}from"./app-Cs9IFEnv.js";import{A as $}from"./AuthLayout-j5mA7mP-.js";/* empty css            *//* empty css             */const L=e.jsxs("svg",{width:"36",height:"36",viewBox:"0 0 24 24",fill:"#fff",children:[e.jsx("circle",{cx:"12",cy:"12",r:"12",fill:"#d96f1a"}),e.jsx("circle",{cx:"12",cy:"9",r:"3.5",fill:"#fff"}),e.jsx("path",{d:"M4.5 19a7.5 7.5 0 0115 0v.5H4.5V19z",fill:"#fff"})]}),T=l=>l===1?"Administrador":l===2?"Moderador":"Leitor",v=l=>(l||"").replace(/\D+/g,""),b=l=>{const r=v(l).slice(0,11);return r.length<=3?r:r.length<=6?`${r.slice(0,3)}.${r.slice(3)}`:r.length<=9?`${r.slice(0,3)}.${r.slice(3,6)}.${r.slice(6)}`:`${r.slice(0,3)}.${r.slice(3,6)}.${r.slice(6,9)}-${r.slice(9)}`};function U(){const{props:l}=D(),r=l.users??[],h=!!(l.can&&l.can.create),c=document.querySelector('meta[name="csrf-token"]')?.content||"",[n,o]=i.useState(null);i.useEffect(()=>{let s;return l.flash?.success?(o({text:l.flash.success,type:"ok"}),s=setTimeout(()=>o(null),3e3)):l.flash?.error&&(o({text:l.flash.error,type:"err"}),s=setTimeout(()=>o(null),3e3)),()=>clearTimeout(s)},[l.flash]);const[x,m]=i.useState(null),[_,w]=i.useState(""),a=E({id:null,name:"",cpf:"",email:"",data_nascimento:"",role:3,password:"",password_confirmation:""}),C=s=>{const t=s.cpf_raw?String(s.cpf_raw):v(s.cpf);w(t),m(s),a.setData({id:s.id,name:s.name,cpf:b(t),email:s.email,data_nascimento:"",role:Number(s.role||3),password:"",password_confirmation:""})},y=s=>{s.preventDefault(),a.transform(t=>{const d={...t,role:Number(t.role)},j=v(t.cpf);return j&&j!==_?d.cpf=j:delete d.cpf,d.data_nascimento||delete d.data_nascimento,d}),a.post(`/users/${a.data.id}`,{data:{_method:"put",_token:c},preserveScroll:!0,onSuccess:()=>m(null)})},[u,p]=i.useState(null),k=()=>{u&&a.post(`/users/${u.id}`,{data:{_method:"delete",_token:c},preserveScroll:!0,onFinish:()=>p(null)})},[f,S]=i.useState(""),N=i.useMemo(()=>{const s=f.toLowerCase().trim();return s?r.filter(t=>(t.name||"").toLowerCase().includes(s)||(t.email||"").toLowerCase().includes(s)||(t.cpf||"").toLowerCase().includes(s)):r},[f,r]);return e.jsx($,{children:e.jsxs("div",{className:"page-users page-users--wide",children:[n&&e.jsx("div",{className:`toast-float ${n.type==="ok"?"toast-float--ok":"toast-float--err"}`,role:"status","aria-live":"polite",children:n.text}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",gap:12},children:[e.jsx("h2",{className:"page-users__title",children:"Usuários"}),e.jsxs("div",{style:{display:"flex",gap:8},children:[h&&e.jsx(g,{href:"/users/create",className:"btn",children:"Adicionar usuário"}),e.jsx(g,{href:"/logout",method:"post",as:"button",className:"btn btn--ghost",children:"Sair"})]})]}),e.jsxs("div",{className:"panel panel--wide users-panel",children:[e.jsx("div",{className:"list-head",children:e.jsx("input",{className:"input",placeholder:"Buscar por nome, e-mail ou CPF...",value:f,onChange:s=>S(s.target.value)})}),e.jsxs("div",{className:"list",children:[N.map(s=>e.jsx(q,{u:s,onEdit:()=>C(s),onDelete:()=>p(s)},s.id)),N.length===0&&e.jsx("div",{className:"muted",children:"Nenhum usuário encontrado."})]})]}),x&&e.jsx("div",{className:"modal-overlay",onClick:()=>m(null),children:e.jsxs("div",{className:"modal modal--lg",onClick:s=>s.stopPropagation(),children:[e.jsx("h3",{className:"panel__title",style:{marginTop:0},children:"Editar usuário"}),e.jsxs("form",{onSubmit:y,children:[e.jsxs("div",{className:"field",children:[e.jsx("label",{children:"name"}),e.jsx("input",{className:"input",value:a.data.name,onChange:s=>a.setData("name",s.target.value),required:!0}),a.errors.name&&e.jsx("small",{className:"error",children:a.errors.name})]}),e.jsxs("div",{className:"field",children:[e.jsx("label",{children:"CPF"}),e.jsx("input",{className:"input",inputMode:"numeric",value:a.data.cpf,onChange:s=>a.setData("cpf",b(s.target.value)),required:!0}),a.errors.cpf&&e.jsx("small",{className:"error",children:a.errors.cpf})]}),e.jsxs("div",{className:"field",children:[e.jsx("label",{children:"E-mail"}),e.jsx("input",{className:"input",type:"email",value:a.data.email,onChange:s=>a.setData("email",s.target.value),required:!0}),a.errors.email&&e.jsx("small",{className:"error",children:a.errors.email})]}),e.jsxs("div",{className:"field",children:[e.jsx("label",{children:"Nível"}),e.jsxs("select",{className:"input",value:a.data.role,onChange:s=>a.setData("role",Number(s.target.value)),children:[e.jsx("option",{value:1,children:"Administrador"}),e.jsx("option",{value:2,children:"Moderador"}),e.jsx("option",{value:3,children:"Leitor"})]}),a.errors.role&&e.jsx("small",{className:"error",children:a.errors.role})]}),e.jsxs("div",{className:"field",children:[e.jsx("label",{children:"Nova senha (opcional)"}),e.jsx("input",{className:"input",type:"password",value:a.data.password,onChange:s=>a.setData("password",s.target.value)}),a.errors.password&&e.jsx("small",{className:"error",children:a.errors.password})]}),e.jsxs("div",{className:"field",children:[e.jsx("label",{children:"Confirmar nova senha"}),e.jsx("input",{className:"input",type:"password",value:a.data.password_confirmation,onChange:s=>a.setData("password_confirmation",s.target.value)})]}),e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{type:"button",className:"btn btn--ghost",onClick:()=>m(null),children:"Cancelar"}),e.jsx("button",{className:"btn",disabled:a.processing,children:"Salvar"})]})]})]})}),u&&e.jsx("div",{className:"modal-overlay",onClick:()=>p(null),children:e.jsxs("div",{className:"modal modal--sm",onClick:s=>s.stopPropagation(),children:[e.jsx("h3",{className:"panel__title",style:{marginTop:0},children:"Excluir usuário"}),e.jsxs("p",{children:["Tem certeza que deseja excluir ",e.jsx("strong",{children:u.name}),"?"]}),e.jsxs("div",{className:"modal-actions",children:[e.jsx("button",{className:"btn btn--ghost",onClick:()=>p(null),children:"Cancelar"}),e.jsx("button",{className:"btn",onClick:k,disabled:a.processing,children:"Excluir"})]})]})})]})})}function q({u:l,onEdit:r,onDelete:h}){const[c,n]=i.useState(!1),o=l.role===1?"chip chip--admin":l.role===2?"chip chip--mod":"chip chip--view";return e.jsxs("div",{className:"user-row user-row--desktop",children:[e.jsxs("div",{className:"user-row__left",children:[e.jsx("div",{className:"user-row__avatar",children:L}),e.jsxs("div",{className:"user-row__meta",children:[e.jsx("div",{className:"user-row__email truncate",children:l.email}),e.jsx("div",{className:"user-row__name truncate",children:l.name})]})]}),e.jsxs("div",{className:"user-row__right",children:[e.jsx("span",{className:o,children:T(l.role)}),e.jsxs("div",{className:"actions",children:[e.jsx("button",{className:"btn btn--small btn--secondary",onClick:()=>n(x=>!x),"aria-expanded":c,"aria-haspopup":"menu",children:"Ações ▾"}),c&&e.jsxs("div",{className:"menu",role:"menu",onMouseLeave:()=>n(!1),children:[e.jsx("button",{className:"menu__item",onClick:()=>{n(!1),r()},disabled:!l.can.edit,children:"Editar"}),e.jsx("button",{className:"menu__item",onClick:()=>{n(!1),h()},disabled:!l.can.delete,children:"Excluir"})]})]})]})]})}export{U as default};
